


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../../images/leaf.svg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>9 - Configure Authentication with SAML2 - Leaf</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.5ce4f19a.min.css">
      
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.24ef6ec6.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="pink">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#9-configure-authentication-with-saml2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../../.." title="Leaf" class="md-header-nav__button md-logo" aria-label="Leaf">
      
  <img src="../../../images/leaf.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Leaf
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              9 - Configure Authentication with SAML2
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/uwrit/leaf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Leaf
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../../.." class="md-tabs__link">
        What is Leaf?
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../FAQs/" class="md-tabs__link">
          FAQs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../administration/" class="md-tabs__link">
          Administration
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../../development_and_testing/" class="md-tabs__link">
          Development and testing
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../" class="md-tabs__link md-tabs__link--active">
          Installation
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Leaf" class="md-nav__button md-logo" aria-label="Leaf">
      
  <img src="../../../images/leaf.svg" alt="logo">

    </a>
    Leaf
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/uwrit/leaf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Leaf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../../.." title="What is Leaf?" class="md-nav__link">
      What is Leaf?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../about/" title="The Leaf Team" class="md-nav__link">
      The Leaf Team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../contributing/" title="Contributing to Leaf" class="md-nav__link">
      Contributing to Leaf
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../leaf_help_research/" title="How can Leaf help biomedical research?" class="md-nav__link">
      How can Leaf help biomedical research?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../../sponsor/" title="Leaf Sponsors" class="md-nav__link">
      Leaf Sponsors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      FAQs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQs" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        FAQs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../FAQs/" title="Troubleshooting and FAQs" class="md-nav__link">
      Troubleshooting and FAQs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Administration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Administration" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/" title="Administration" class="md-nav__link">
      Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/concept_reference/" title="Concept Reference" class="md-nav__link">
      Concept Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/concepts/" title="The Building Blocks of Leaf: Concepts" class="md-nav__link">
      The Building Blocks of Leaf: Concepts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/dataset_template_reference/" title="Dataset Templates Reference" class="md-nav__link">
      Dataset Templates Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/datasets/" title="Extracting Data for a Cohort: Datasets" class="md-nav__link">
      Extracting Data for a Cohort: Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../../administration/federation/" title="Networking Multiple Leaf instances" class="md-nav__link">
      Networking Multiple Leaf instances
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Development and testing
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Development and testing" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Development and testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../../development_and_testing/" title="Development and Testing" class="md-nav__link">
      Development and Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9" checked>
    
    <label class="md-nav__link" for="nav-9">
      Installation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Installation" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2" checked>
    
    <label class="md-nav__link" for="nav-9-2">
      Installation steps
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Installation steps" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Installation steps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1_app_db/" title="1 - Create App Database" class="md-nav__link">
      1 - Create App Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2_app_server/" title="2 - Configure App Server" class="md-nav__link">
      2 - Configure App Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3_jwt/" title="3 - Create a JWT Signing Key" class="md-nav__link">
      3 - Create a JWT Signing Key
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4_compile_api/" title="4 - Compile the Leaf API" class="md-nav__link">
      4 - Compile the Leaf API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5_compile_client/" title="5 - Build the Leaf Client" class="md-nav__link">
      5 - Build the Leaf Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6_appsettings/" title="6 - Configure the appsettings file" class="md-nav__link">
      6 - Configure the appsettings file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../7_env/" title="7 - Set Environment Variables" class="md-nav__link">
      7 - Set Environment Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../8a_configure_apache/" title="8a - Configure Leaf with Apache" class="md-nav__link">
      8a - Configure Leaf with Apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../8b_configure_iis/" title="8b - Configure Leaf with IIS" class="md-nav__link">
      8b - Configure Leaf with IIS
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        9 - Configure Authentication with SAML2
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="9 - Configure Authentication with SAML2" class="md-nav__link md-nav__link--active">
      9 - Configure Authentication with SAML2
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identity-providers-idp" class="md-nav__link">
    Identity Providers (IdP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-providers-sp" class="md-nav__link">
    Service Providers (SP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#route-protection-setup" class="md-nav__link">
    Route Protection Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-servers" class="md-nav__link">
    Web Servers
  </a>
  
    <nav class="md-nav" aria-label="Web Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iis" class="md-nav__link">
    IIS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" class="md-nav__link">
    Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adfs" class="md-nav__link">
    ADFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shibboleth" class="md-nav__link">
    Shibboleth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iisadfs" class="md-nav__link">
    IIS/ADFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apacheshibboleth" class="md-nav__link">
    Apache/Shibboleth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#identity-providers-idp" class="md-nav__link">
    Identity Providers (IdP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#service-providers-sp" class="md-nav__link">
    Service Providers (SP)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#route-protection-setup" class="md-nav__link">
    Route Protection Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-servers" class="md-nav__link">
    Web Servers
  </a>
  
    <nav class="md-nav" aria-label="Web Servers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iis" class="md-nav__link">
    IIS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apache" class="md-nav__link">
    Apache
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adfs" class="md-nav__link">
    ADFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shibboleth" class="md-nav__link">
    Shibboleth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    Examples
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iisadfs" class="md-nav__link">
    IIS/ADFS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#apacheshibboleth" class="md-nav__link">
    Apache/Shibboleth
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/uwrit/leaf/edit/master/docs/installation/installation_steps/9_saml2.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="9-configure-authentication-with-saml2">9 - Configure Authentication with SAML2</h1>
<p><img alt="Infra" src="../../images/infra_saml2_focus.png" title="Architecure-Focus-Example" /> </p>
<p>Leaf delegates support of SAML2 authentication and authorization mechanisms to the various battle-tested and well supported implementations from the open source community (e.g. <a href="https://wiki.shibboleth.net/confluence/display/SP3/Home" target="_blank">Shibboleth</a>). We rely on these implementations for integrating Leaf into your environment.</p>
<h2 id="identity-providers-idp">Identity Providers (IdP)</h2>
<p>Conceptually, Leaf does not depend concretely on any specific method of authentication. Instead, it only requires the following structured data be written to the request headers:</p>
<ul>
<li>A scoped identity of the form "&lt;identity>@&lt;scope>".</li>
<li>A set of entitlements or group memberships in the form of a character delimited list.</li>
</ul>
<p>Two well known IdP implementations that we've interacted with are:</p>
<ul>
<li><a href="#adfs">Active Directory Federation Services (ADFS)</a></li>
<li><a href="#shibboleth">Shibboleth</a></li>
</ul>
<p>For example:</p>
<ul>
<li>
<p>UW's Shibboleth IdP sends:</p>
<ul>
<li>The <code>eppn</code> attribute with a value of <code>johndoe@washington.edu</code>.</li>
<li>The <code>gws_groups</code> attribute with a value of <code>urn:mace:washington.edu:groups:uw_iths_it; urn:mace:washington.edu:groups:uw_rit_leaf_admins; urn:mace:washington.edu:groups:uw_rit_leaf_users</code></li>
</ul>
</li>
<li>
<p>UW Medicine's ADFS IdP sends:</p>
<ul>
<li>The <code>sAMAccountName</code> attribute with a value of <code>johndoe@amc.uwmedicine.org</code>.</li>
<li>The <code>amc_groups</code> attribute with a value of <code>am_leaf_users; am_leaf_admins; amSQL_RIT_Leaf_Admin</code></li>
</ul>
</li>
</ul>
<h2 id="service-providers-sp">Service Providers (SP)</h2>
<p>There are multiple implementations of the Service Provider role in the SAML2 protocol, but as we have only ever used Shibboleth and as such will refer to that in the following documentation.</p>
<ul>
<li><a href="https://shibboleth.net/downloads/service-provider/latest" target="_blank">Shibboleth SP Installation Media</a></li>
<li><a href="https://wiki.shibboleth.net/confluence/display/SP3/Installation" target="_blank">Shibboleth SP Installation Documentation</a></li>
</ul>
<h2 id="route-protection-setup">Route Protection Setup</h2>
<p>There are only two routes that <em>must</em> be protected by the SAML2 Service Provider (SP), all other routes are protected by requiring a JWT that can only be generated from a SAML2 SP protected endpoint.</p>
<ul>
<li><code>/</code>           --&gt; React client app.</li>
<li><code>/api/config</code> --&gt; Initial API check endpoint.</li>
<li><code>/api/user</code>   --&gt; Token generation endpoint.</li>
</ul>
<p>In a non-federated deployment, you can also elect to protect the entire API surface.</p>
<p><strong>Caution</strong>: If you are running Leaf's React application at the root of an IIS Server (e.g. <code>leaf.uwmedicine.org</code> instead of <code>leaf.uwmedicine.org/leaf</code>), <strong>make sure to make <code>leaf.uwmedicine.org/leafApi</code> unprotected also.</strong></p>
<p>Protecting the root of the React app <code>leaf.uwmedicine.org</code> in Shibboleth will automatically make all sub paths protected. If exceptions are only made for requests with the <code>/api</code> path (except for <code>/api/config</code> and <code>/api/user/</code>, noted above), once the URL Rewrite rule changes the request to the <code>/leafApi</code> path, Shibboleth will intercept this request and not allow the React App to call the API. This will break the application.</p>
<h2 id="web-servers">Web Servers</h2>
<h3 id="iis">IIS</h3>
<p>IIS requires a specific <code>ISAPI</code> element within the <code>InProcess</code> element. Additionally, .NET Core does not support server variables and so the IdP provided user attributes must be written to the request headers. A prototypical IIS <code>InProcess</code> element looks like:</p>
<pre><code class="xml">&lt;InProcess&gt;
    ...additional configuration
    &lt;ISAPI normalizeRequest=&quot;true&quot; safeHeaderNames=&quot;true&quot; useHeaders=&quot;true&quot;&gt;
        &lt;Site id=&quot;1&quot; name=&quot;&lt;server&gt;.&lt;subdomain&gt;.&lt;your_institution&gt;.&lt;tld&gt;&quot;/&gt;
    &lt;/ISAPI&gt;
&lt;/InProcess&gt;
</code></pre>

<h3 id="apache">Apache</h3>
<p>There is no extra Shibboleth Service Provider configuration required to interoperate with Apache.</p>
<h3 id="adfs">ADFS</h3>
<p>Shibboleth Service Provider 3 can be configured to work with ADFS. However, it requires a couple extensions bundled with the installation. The extensions are loaded into the <code>OutOfProcess</code> and <code>InProcess</code> elements via the <code>Extensions</code> element. A prototypical ADFS configuration looks like:</p>
<pre><code class="xml">&lt;OutOfProcess tranLogFormat=&quot;%u|%s|%IDP|%i|%ac|%t|%attr|%n|%b|%E|%S|%SS|%L|%UA|%a&quot;&gt;
    &lt;Extensions&gt;
        &lt;Library path=&quot;adfs.so&quot; fatal=&quot;true&quot;/&gt;
    &lt;/Extensions&gt;
&lt;/OutOfProcess&gt;

&lt;InProcess&gt;
    &lt;Extensions&gt;
        &lt;Library path=&quot;adfs-lite.so&quot; fatal=&quot;true&quot;/&gt;
    &lt;/Extensions&gt;
    ...ISAPI configuration if running in IIS
&lt;/InProcess&gt;
</code></pre>

<h3 id="shibboleth">Shibboleth</h3>
<p>There is no extra Shibboleth Service Provider configuration required to interoperate with a Shibboleth IdP.</p>
<h2 id="examples">Examples</h2>
<h3 id="iisadfs">IIS/ADFS</h3>
<p>Configure Shibboleth SP3 with IIS and ADFS 3.0.</p>
<p>shibboleth2.xml</p>
<pre><code class="xml">&lt;SPConfig xmlns=&quot;urn:mace:shibboleth:3.0:native:sp:config&quot;
    xmlns:conf=&quot;urn:mace:shibboleth:3.0:native:sp:config&quot;
    clockSkew=&quot;180&quot;&gt;

    &lt;OutOfProcess tranLogFormat=&quot;%u|%s|%IDP|%i|%ac|%t|%attr|%n|%b|%E|%S|%SS|%L|%UA|%a&quot;&gt;
        &lt;Extensions&gt;
            &lt;Library path=&quot;adfs.so&quot; fatal=&quot;true&quot;/&gt;
        &lt;/Extensions&gt;
    &lt;/OutOfProcess&gt;

    &lt;InProcess&gt;
        &lt;Extensions&gt;
            &lt;Library path=&quot;adfs-lite.so&quot; fatal=&quot;true&quot;/&gt;
        &lt;/Extensions&gt;
        &lt;ISAPI normalizeRequest=&quot;true&quot; safeHeaderNames=&quot;true&quot; useHeaders=&quot;true&quot;&gt;
            &lt;Site id=&quot;1&quot; name=&quot;&lt;server&gt;.&lt;subdomain&gt;.&lt;institution&gt;.&lt;tld&gt;&quot;/&gt;
        &lt;/ISAPI&gt;
    &lt;/InProcess&gt;

    &lt;RequestMapper type=&quot;Native&quot;&gt;
        &lt;RequestMap&gt;
            &lt;Host name=&quot;&lt;server&gt;.&lt;subdomain&gt;.&lt;institution&gt;.&lt;tld&gt;&quot; requireSession=&quot;true&quot; authType=&quot;shibboleth&quot;&gt;
            &lt;/Host&gt;
        &lt;/RequestMap&gt;
    &lt;/RequestMapper&gt;

    &lt;ApplicationDefaults entityID=&quot;https://&lt;server&gt;.&lt;subdomain&gt;.&lt;institution&gt;.&lt;tld&gt;/shibboleth&quot;
        REMOTE_USER=&quot;nameID&quot;
        cipherSuites=&quot;DEFAULT:!EXP:!LOW:!aNULL:!eNULL:!DES:!IDEA:!SEED:!RC4:!3DES:!kRSA:!SSLv2:!SSLv3:!TLSv1:!TLSv1.1&quot;&gt;

        &lt;Sessions lifetime=&quot;28800&quot; timeout=&quot;3600&quot; relayState=&quot;ss:mem&quot;
                  checkAddress=&quot;false&quot; handlerSSL=&quot;true&quot; cookieProps=&quot;https&quot;&gt;

            &lt;SSO id=&quot;&lt;idp_abbreviation&gt;&quot; isDefault=&quot;true&quot; entityID=&quot;&lt;idp_entityID&gt;&quot;&gt;
                SAML2
            &lt;/SSO&gt;

            &lt;!-- local-only logout. --&gt;
            &lt;Logout&gt;Local&lt;/Logout&gt;

            &lt;!-- Administrative logout. --&gt;
            &lt;LogoutInitiator type=&quot;Admin&quot; Location=&quot;/Logout/Admin&quot; acl=&quot;127.0.0.1 ::1&quot; /&gt;

            &lt;!-- Extension service that generates &quot;approximate&quot; metadata based on SP configuration. --&gt;
            &lt;Handler type=&quot;MetadataGenerator&quot; Location=&quot;/Metadata&quot; signing=&quot;false&quot;/&gt;

            &lt;!-- Status reporting service. --&gt;
            &lt;Handler type=&quot;Status&quot; Location=&quot;/Status&quot; acl=&quot;127.0.0.1 ::1&quot;/&gt;

            &lt;!-- Session diagnostic service. --&gt;
            &lt;Handler type=&quot;Session&quot; Location=&quot;/Session&quot; showAttributeValues=&quot;false&quot;/&gt;

            &lt;!-- JSON feed of discovery information. --&gt;
            &lt;Handler type=&quot;DiscoveryFeed&quot; Location=&quot;/DiscoFeed&quot;/&gt;
        &lt;/Sessions&gt;

        &lt;Errors supportContact=&quot;root@localhost&quot;
            helpLocation=&quot;/about.html&quot;
            styleSheet=&quot;/shibboleth-sp/main.css&quot;/&gt;

        &lt;!-- Example of remotely supplied batch of signed metadata. --&gt;
        &lt;MetadataProvider type=&quot;XML&quot; validate=&quot;true&quot;
                url=&quot;&lt;idp_metadata_url&gt;&quot;
              backingFilePath=&quot;federation-metadata.xml&quot; maxRefreshDelay=&quot;7200&quot;&gt;
        &lt;/MetadataProvider&gt;

      &lt;!-- Map to extract attributes from SAML assertions. --&gt;
        &lt;AttributeExtractor type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;attribute-map.xml&quot;/&gt;

        &lt;!-- Default filtering policy for recognized attributes, lets other data pass. --&gt;
        &lt;AttributeFilter type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;attribute-policy.xml&quot;/&gt;

        &lt;!-- Simple file-based resolvers for separate signing/encryption keys. --&gt;
        &lt;CredentialResolver type=&quot;File&quot; use=&quot;signing&quot;
            key=&quot;sp-signing-key.pem&quot; certificate=&quot;sp-signing-cert.pem&quot;/&gt;
        &lt;CredentialResolver type=&quot;File&quot; use=&quot;encryption&quot;
            key=&quot;sp-encrypt-key.pem&quot; certificate=&quot;sp-encrypt-cert.pem&quot;/&gt;
    &lt;/ApplicationDefaults&gt;

    &lt;!-- Policies that determine how to process and authenticate runtime messages. --&gt;
    &lt;SecurityPolicyProvider type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;security-policy.xml&quot;/&gt;

    &lt;!-- Low-level configuration about protocols and bindings available for use. --&gt;
    &lt;ProtocolProvider type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;protocols.xml&quot;/&gt;

&lt;/SPConfig&gt;
</code></pre>

<p>attribute-map.xml</p>
<pre><code class="xml">&lt;Attributes xmlns=&quot;urn:mace:shibboleth:2.0:attribute-map&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
    &lt;Attribute name=&quot;urn:oasis:names:tc:SAML:1.1:nameid-format:unspecified&quot; id=&quot;nameID&quot;/&gt;
    &lt;Attribute name=&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&quot; id=&quot;groups&quot; /&gt;
&lt;/Attributes&gt;
</code></pre>

<p>The above example could be highly variable depending on your ADFS IdP set up, and how your relying party's claims are configured.</p>
<h3 id="apacheshibboleth">Apache/Shibboleth</h3>
<p>Configure Shibboleth SP3 with Apache and Shibboleth IdP. This example uses InCommon Federation metadata, but would only allow authentication by the specified IdP.</p>
<p>shibboleth2.xml</p>
<pre><code class="xml">&lt;SPConfig xmlns=&quot;urn:mace:shibboleth:3.0:native:sp:config&quot;
    xmlns:conf=&quot;urn:mace:shibboleth:3.0:native:sp:config&quot;
    clockSkew=&quot;180&quot;&gt;

    &lt;ApplicationDefaults entityID=&quot;https://&lt;server&gt;.&lt;subdomain&gt;.&lt;institution&gt;.&lt;tld&gt;/shibboleth&quot;
                         REMOTE_USER=&quot;eppn persistent-id targeted-id&quot;&gt;

        &lt;Sessions lifetime=&quot;28800&quot; timeout=&quot;3600&quot; checkAddress=&quot;false&quot;
                  relayState=&quot;ss:mem&quot; handlerSSL=&quot;true&quot; cookieProps=&quot;https&quot;&gt;

            &lt;SSO id=&quot;&lt;abbrev&gt;&quot; isDefault=&quot;true&quot; entityID=&quot;&lt;IdP supplied entityID&gt;&quot;&gt;
                SAML2 SAML1
            &lt;/SSO&gt;

            &lt;!-- local-only logout. --&gt;
            &lt;Logout&gt;Local&lt;/Logout&gt;

            &lt;!-- Extension service that generates &quot;approximate&quot; metadata based on SP configuration. --&gt;
            &lt;Handler type=&quot;MetadataGenerator&quot; Location=&quot;/Metadata&quot; signing=&quot;false&quot;/&gt;

            &lt;!-- Status reporting service. --&gt;
            &lt;Handler type=&quot;Status&quot; Location=&quot;/Status&quot; acl=&quot;127.0.0.1 ::1&quot;/&gt;

            &lt;!-- Session diagnostic service. --&gt;
            &lt;Handler type=&quot;Session&quot; Location=&quot;/Session&quot; showAttributeValues=&quot;true&quot;/&gt;

            &lt;!-- JSON feed of discovery information. --&gt;
            &lt;Handler type=&quot;DiscoveryFeed&quot; Location=&quot;/DiscoFeed&quot; dir=&quot;/data/shibds/discofeed&quot;/&gt;
        &lt;/Sessions&gt;

        &lt;Errors supportContact=&quot;root@localhost&quot;
            helpLocation=&quot;/about.html&quot;
            styleSheet=&quot;/shibboleth-sp/main.css&quot;/&gt;

        &lt;MetadataProvider type=&quot;XML&quot;
            url=&quot;http://md.incommon.org/InCommon/InCommon-metadata-idp-only.xml&quot;
            backingFilePath=&quot;InCommon-metadata-idp-only.xml&quot;
            maxRefreshDelay=&quot;3600&quot;&gt;

            &lt;MetadataFilter type=&quot;RequireValidUntil&quot; maxValidityInterval=&quot;1209600&quot;/&gt;

            &lt;MetadataFilter type=&quot;Signature&quot;
                certificate=&quot;/etc/pki/tls/certs/inc-md-cert.pem&quot;/&gt;

            &lt;MetadataFilter type=&quot;EntityRoleWhiteList&quot;&gt;
              &lt;RetainedRole&gt;md:IDPSSODescriptor&lt;/RetainedRole&gt;
              &lt;RetainedRole&gt;md:AttributeAuthorityDescriptor&lt;/RetainedRole&gt;
            &lt;/MetadataFilter&gt;

        &lt;/MetadataProvider&gt;

        &lt;!-- Map to extract attributes from SAML assertions. --&gt;
        &lt;AttributeExtractor type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;attribute-map.xml&quot;/&gt;

        &lt;!-- Use a SAML query if no attributes are supplied during SSO. --&gt;
        &lt;AttributeResolver type=&quot;Query&quot; subjectMatch=&quot;true&quot;/&gt;

        &lt;!-- Default filtering policy for recognized attributes, lets other data pass. --&gt;
        &lt;AttributeFilter type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;attribute-policy.xml&quot;/&gt;

        &lt;!-- Simple file-based resolver for using a single keypair. --&gt;
        &lt;CredentialResolver type=&quot;File&quot;
                key=&quot;/etc/pki/tls/private/leaf.rit.uw.edu-shibd-self.key&quot;
                certificate=&quot;/etc/pki/tls/certs/leaf.rit.uw.edu-shibd-self.cert&quot; /&gt;

    &lt;/ApplicationDefaults&gt;

    &lt;!-- Policies that determine how to process and authenticate runtime messages. --&gt;
    &lt;SecurityPolicyProvider type=&quot;XML&quot; validate=&quot;true&quot; path=&quot;security-policy.xml&quot;/&gt;

    &lt;!-- Low-level configuration about protocols and bindings available for use. --&gt;
    &lt;ProtocolProvider type=&quot;XML&quot; validate=&quot;true&quot; reloadChanges=&quot;false&quot; path=&quot;protocols.xml&quot;/&gt;

&lt;/SPConfig&gt;
</code></pre>

<hr />
<p><br>
If you've made it this far, awesome! You've successfully configured Leaf to run in your environment.</p>
<p>We promise the next steps are more fun. Next we'll configure Leaf to run queries on your clinical database.</p>
<p>Next: <a href="/administration">Leaf Administration</a></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../8b_configure_iis/" title="8b - Configure Leaf with IIS" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                8b - Configure Leaf with IIS
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/uwrit/leaf" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../../search/main.js"></script>
      
    
  </body>
</html>