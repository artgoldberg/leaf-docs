


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../images/leaf.svg">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.2.2">
    
    
      
        <title>The Building Blocks of Leaf: Concepts - Leaf</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.5ce4f19a.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.24ef6ec6.min.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="pink">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-building-blocks-of-leaf-concepts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Leaf" class="md-header-nav__button md-logo" aria-label="Leaf">
      
  <img src="../../images/leaf.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Leaf
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              The Building Blocks of Leaf: Concepts
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/uwrit/leaf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Leaf
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." class="md-tabs__link">
        What is Leaf?
      </a>
    
  </li>

      
        
      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../FAQs/" class="md-tabs__link">
          FAQs
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" class="md-tabs__link md-tabs__link--active">
          Administration
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../development_and_testing/" class="md-tabs__link">
          Development and testing
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../installation/" class="md-tabs__link">
          Installation
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Leaf" class="md-nav__button md-logo" aria-label="Leaf">
      
  <img src="../../images/leaf.svg" alt="logo">

    </a>
    Leaf
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/uwrit/leaf/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Leaf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="What is Leaf?" class="md-nav__link">
      What is Leaf?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="The Leaf Team" class="md-nav__link">
      The Leaf Team
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../contributing/" title="Contributing to Leaf" class="md-nav__link">
      Contributing to Leaf
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../leaf_help_research/" title="How can Leaf help biomedical research?" class="md-nav__link">
      How can Leaf help biomedical research?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../sponsor/" title="Leaf Sponsors" class="md-nav__link">
      Leaf Sponsors
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      FAQs
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="FAQs" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        FAQs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../FAQs/" title="Troubleshooting and FAQs" class="md-nav__link">
      Troubleshooting and FAQs
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" checked>
    
    <label class="md-nav__link" for="nav-7">
      Administration
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Administration" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Administration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Administration" class="md-nav__link">
      Administration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../concept_reference/" title="Concept Reference" class="md-nav__link">
      Concept Reference
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        The Building Blocks of Leaf: Concepts
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="The Building Blocks of Leaf: Concepts" class="md-nav__link md-nav__link--active">
      The Building Blocks of Leaf: Concepts
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuring-the-sql-compiler" class="md-nav__link">
    Configuring the SQL compiler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-sql-sets" class="md-nav__link">
    Creating SQL Sets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-concepts" class="md-nav__link">
    Creating Concepts
  </a>
  
    <nav class="md-nav" aria-label="Creating Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#demographics" class="md-nav__link">
    Demographics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gender" class="md-nav__link">
    Gender
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#road-test" class="md-nav__link">
    Road test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encounters" class="md-nav__link">
    Encounters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-concepts-searchable" class="md-nav__link">
    Making Concepts Searchable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../dataset_template_reference/" title="Dataset Templates Reference" class="md-nav__link">
      Dataset Templates Reference
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../datasets/" title="Extracting Data for a Cohort: Datasets" class="md-nav__link">
      Extracting Data for a Cohort: Datasets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../federation/" title="Networking Multiple Leaf instances" class="md-nav__link">
      Networking Multiple Leaf instances
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Development and testing
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Development and testing" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Development and testing
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development_and_testing/" title="Development and Testing" class="md-nav__link">
      Development and Testing
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Installation
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Installation" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Installation
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9-2" type="checkbox" id="nav-9-2">
    
    <label class="md-nav__link" for="nav-9-2">
      Installation steps
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Installation steps" data-md-level="2">
      <label class="md-nav__title" for="nav-9-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Installation steps
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/1_app_db/" title="1 - Create App Database" class="md-nav__link">
      1 - Create App Database
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/2_app_server/" title="2 - Configure App Server" class="md-nav__link">
      2 - Configure App Server
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/3_jwt/" title="3 - Create a JWT Signing Key" class="md-nav__link">
      3 - Create a JWT Signing Key
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/4_compile_api/" title="4 - Compile the Leaf API" class="md-nav__link">
      4 - Compile the Leaf API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/5_compile_client/" title="5 - Build the Leaf Client" class="md-nav__link">
      5 - Build the Leaf Client
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/6_appsettings/" title="6 - Configure the appsettings file" class="md-nav__link">
      6 - Configure the appsettings file
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/7_env/" title="7 - Set Environment Variables" class="md-nav__link">
      7 - Set Environment Variables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/8a_configure_apache/" title="8a - Configure Leaf with Apache" class="md-nav__link">
      8a - Configure Leaf with Apache
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/8b_configure_iis/" title="8b - Configure Leaf with IIS" class="md-nav__link">
      8b - Configure Leaf with IIS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../installation/installation_steps/9_saml2/" title="9 - Configure Authentication with SAML2" class="md-nav__link">
      9 - Configure Authentication with SAML2
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configuring-the-sql-compiler" class="md-nav__link">
    Configuring the SQL compiler
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-sql-sets" class="md-nav__link">
    Creating SQL Sets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-concepts" class="md-nav__link">
    Creating Concepts
  </a>
  
    <nav class="md-nav" aria-label="Creating Concepts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#demographics" class="md-nav__link">
    Demographics
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gender" class="md-nav__link">
    Gender
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#road-test" class="md-nav__link">
    Road test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encounters" class="md-nav__link">
    Encounters
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#making-concepts-searchable" class="md-nav__link">
    Making Concepts Searchable
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#final-thoughts" class="md-nav__link">
    Final thoughts
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/uwrit/leaf/edit/master/docs/administration/concepts.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="the-building-blocks-of-leaf-concepts">The Building Blocks of Leaf: Concepts</h1>
<p>Leaf is a SQL writing and execution engine. While it is designed to be fun and intuitive for users, ultimately Leaf's most important job is to reliably and flexibly construct SQL queries using a few simple but powerful configuration rules. </p>
<p>Let's start with an example. We'll use an <a href="https://www.ohdsi.org/data-standardization/the-common-data-model/">OMOP</a> v5 database for this example, though these steps can be applied to any particular data model. We'll focus on using the <code>person</code> and <code>visit_occurrence</code> tables via views in our OMOP database.</p>
<p>The goals are:</p>
<ol>
<li>
<p>Configure the Leaf SQL compiler.</p>
</li>
<li>
<p>Create Leaf SQL Sets for the <code>v_person</code> and <code>v_visit_occurrence</code> views.</p>
</li>
<li>
<p>Create basic demographics and encounter Concepts which query our clinical database.</p>
</li>
</ol>
<h2 id="configuring-the-sql-compiler">Configuring the SQL compiler</h2>
<p>Every Leaf instance assumes that there is a single, consistent field that represents patient identifiers. In OMOP databases this is the <code>person_id</code> field, which can be found on nearly any table with patient data. Likewise, Leaf assumes that longitudinal tables in the database will have a consistent field representing encounter identifiers. In OMOP this is the <code>visit_occurrence_id</code> field.</p>
<p>Before starting, let's create two SQL views called <code>v_person</code> and <code>v_visit_occurrence</code> to make the <code>person</code> and <code>visit_occurrence</code> tables simpler to query. This example is specific to OMOP but the approach works for other models as well. Note that pointing Leaf at views is completely <em>optional</em> and demonstrated here for convenience and illustrative purposes.</p>
<p>Our <code>v_person</code> view is defined as:</p>
<pre><code class="sql">CREATE VIEW dbo.v_person AS
SELECT
    p.person_id
  , p.birth_datetime
  , gender           = c_gender.concept_code
  , race             = c_race.concept_name
  , ethnicity        = c_ethnicity.concept_name
  , location_state   = loc.state
FROM dbo.person AS p
     LEFT JOIN dbo.concept AS c_gender ON p.gender_concept_id = c_gender.concept_id 
     LEFT JOIN dbo.concept AS c_race ON p.race_concept_id = c_race.concept_id 
     LEFT JOIN dbo.concept AS c_ethnicity ON p.ethnicity_concept_id = c_ethnicity.concept_id
     LEFT JOIN dbo.location AS loc ON p.location_id = loc.location_id
</code></pre>

<table>
<thead>
<tr>
<th>person_id</th>
<th>birth_datetime</th>
<th>gender</th>
<th>race</th>
<th>ethnicity</th>
<th>location_state</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>1990-1-1</td>
<td>F</td>
<td>Black or African American</td>
<td>Not Hispanic or Latino</td>
<td>NY</td>
</tr>
<tr>
<td>B</td>
<td>1945-2-2</td>
<td>M</td>
<td>Asian or Pacific Islander</td>
<td>Not Hispanic or Latino</td>
<td>OR</td>
</tr>
</tbody>
</table>
<p>The <code>v_visit_occurrence</code> view is defined as:</p>
<pre><code class="sql">CREATE VIEW dbo.v_visit_occurrence AS
SELECT 
    o.person_id
  , o.visit_occurrence_id
  , o.visit_start_date
  , o.visit_end_date
  , o.care_site_id
  , visit_type_code = c_visit.concept_code
FROM dbo.visit_occurrence AS o 
     LEFT JOIN dbo.concept AS c_visit ON o.visit_concept_id = c_visit.concept_id
</code></pre>

<table>
<thead>
<tr>
<th>person_id</th>
<th>visit_occurrence_id</th>
<th>visit_start_date</th>
<th>visit_end_date</th>
<th>care_site_id</th>
<th>visit_type_code</th>
</tr>
</thead>
<tbody>
<tr>
<td>A</td>
<td>123</td>
<td>2011-01-01</td>
<td>2011-01-01</td>
<td>site1</td>
<td>OP</td>
</tr>
<tr>
<td>A</td>
<td>456</td>
<td>2015-05-28</td>
<td>2015-06-07</td>
<td>site1</td>
<td>IP</td>
</tr>
<tr>
<td>B</td>
<td>789</td>
<td>2014-09-01</td>
<td>2014-09-01</td>
<td>site2</td>
<td>ED</td>
</tr>
</tbody>
</table>
<p>Pretty straightforward so far. After creating the views in the database, let's start by configuring Leaf's <a href="../../deploy/app/#compiler">SQL compiler configuration</a>, which is stored in your compiled API under <code>/api/appsettings.json</code>:</p>
<p align="center"><img src="../images/compiler.gif"/></p>

<p>Let's break it down:</p>
<ul>
<li>
<p><strong>Alias</strong> acts as a indicator to Leaf to insert an alias in a SQL statement wherever this character(s) is found (more on that in a bit). We'll set this to <code>@</code> for simplicity and readability, and because it is commonly used in many Leaf configurations.</p>
</li>
<li>
<p><strong>FieldPersonId</strong> is the name of the SQL field that appears in all tables or views we'd like to query and represents unique identifiers for patients. The field <code>person_id</code> contains identifiers for patients and appears in all tables which link to a patient, so we'll choose that.</p>
</li>
<li>
<p><strong>FieldEncounterId</strong> is the name of the field that represents visit identifiers, so we'll use <code>visit_occurrence_id</code>.</p>
</li>
</ul>
<p>Great - we've now provided the most important information to help Leaf understand the basic structure of our clinical database. Note that these values are expected to be consistent and configured only once. <strong>Also, if you change them, make sure you restart the Leaf API in order for the changes to take effect.</strong></p>
<p>Next, we'll move on to creating Concepts, the building blocks of Leaf queries.</p>
<h2 id="creating-sql-sets">Creating SQL Sets</h2>
<p>We want to allow users to query Concepts using our two new views, <code>v_person</code> and <code>v_visit_occurrence</code>. To do so, let's create a Leaf <code>SQL Set</code> for each. Open up the Leaf client in your web browser.</p>
<p align="center"><img src="../images/login.gif"/></p>

<ol>
<li>
<p>Click <code>Admin</code> -&gt; <code>Concepts</code> on the left sidebar.</p>
<blockquote>
<p>If you don't see the <code>Admin</code> tab, make sure you have configured your <a href="../../deploy/app">admin group correctly</a>.</p>
</blockquote>
</li>
<li>
<p>Click <code>Start by creating a Concept SQL Set</code>. <code>SQL Sets</code> are the SQL tables, views, or subqueries that are the foundation of Concepts and provide their <code>FROM</code> clauses.
<p align="center"><img src="../images/sqlsets.gif"/></p></p>
</li>
<li>
<p>You should see a single white box near the top. Under <code>SQL FROM</code>, enter <code>dbo.v_person</code>.</p>
</li>
<li>
<p>Next, create another <code>SQL Set</code>. Click <code>+ Create New SQL Set</code> and fill in <code>dbo.v_visit_occurrence</code> under <code>SQL FROM</code>. Also, check the <code>Has Encounters</code> box. This indicates that Leaf should expect to find an Encounter identifier and date fields on this table.</p>
</li>
<li>
<p>Under <code>Date Field</code>, fill in <code>@.visit_start_date</code>, which you'll recall is the first date field on the <code>v_visit_occurrence</code> view. Don't forget to prepend the alias placeholder <code>@.</code> before the field name.</p>
</li>
<li>
<p>Click <code>Save</code> at the top. Now we are ready to make a few Concepts that use our <code>v_person</code> and <code>v_visit_occurrence</code> views. </p>
</li>
<li>
<p>Click <code>Back to Concept Editor</code> in the upper-right.</p>
</li>
</ol>
<h2 id="creating-concepts">Creating Concepts</h2>
<p>We've successfully created <code>SQL Sets</code> for our views, so we can now create Concepts that users can interact with.</p>
<p>Our next goal will be to create a basic Concept tree with the following structure:</p>
<pre><code>Demographics
├── Gender
│   ├── Female
│   ├── Male
Encounters
├── Inpatient
├── Outpatient
</code></pre>

<p>Click <code>Back to Concept Editor</code>, then <code>+Create New Concept</code>.</p>
<h3 id="demographics">Demographics</h3>
<p><p align="center"><img src="../images/concept_demographics.gif"/></p></p>
<ol>
<li>
<p>Under <code>Name</code>, fill in "Demographics". This will be the text that users see in the Concept tree.</p>
</li>
<li>
<p>Go down to <code>Full Text</code> and enter "Have demographics". Users will see this text if dragged over to create a query. Why is <code>Full Text</code> different than <code>Name</code>? The intent here is to make the query as descriptive as possible in something approximating an English sentence.</p>
</li>
<li>
<p>Lastly, under the <code>SQL</code> section make sure the <code>Table, View, or Subquery</code> box shows <code>dbo.v_person</code> and the  <code>WHERE Clause</code> field is empty. Click <code>Save</code> at the top.</p>
</li>
</ol>
<p>As you may have noticed, this Concept is intended to simply serve as a hierachical container for Concepts under it related to Demographics. By itself it will likely not be very useful to users, and if they were to drag it over the query would be something simple like <code>SELECT person_id FROM dbo.v_person</code>, in other words, all patients in the table.</p>
<p>Next let's create the <code>Gender</code> Concept, which will appear under <code>Demographics</code>. Click <code>+Create New Concept</code> at the top.</p>
<h3 id="gender">Gender</h3>
<p><p align="center"><img src="../images/concept_gender.gif"/></p></p>
<ol>
<li>
<p>Under <code>Name</code>, fill in "Gender", and under <code>Full Text</code>, fill in "Identify with a gender". </p>
</li>
<li>
<p>We want this Concept to appear beneath <code>Demographics</code>, so drag the new Concept <em>into</em> it in order set <code>Demographics</code> as the parent Concept.</p>
</li>
<li>
<p>Finally, as this Concept represents data about patient gender, users presumably would expect that patients without this data should be excluded. Under <code>SQL</code> -&gt; <code>WHERE Clause</code> enter <code>@.gender IS NOT NULL</code>.</p>
</li>
</ol>
<p>Click <code>Save</code>. Repeat the process for the final two demographic Concepts, <code>Female</code> and <code>Male</code>, with the following data:</p>
<ul>
<li>Female<ul>
<li>General Display<ul>
<li><code>Name</code>: "Female"</li>
<li><code>Full text</code>: "Identify as female"</li>
</ul>
</li>
<li>SQL<ul>
<li><code>Table, View, or Subquery</code>: "dbo.v_person"</li>
<li><code>WHERE Clause</code>: "@.gender = 'F'"</li>
</ul>
</li>
</ul>
</li>
<li>Male<ul>
<li>General Display<ul>
<li><code>Name</code>: "Male"</li>
<li><code>Full text</code>: "Identify as male"</li>
</ul>
</li>
<li>SQL<ul>
<li><code>Table, View, or Subquery</code>: "dbo.v_person"</li>
<li><code>WHERE Clause</code>: "@.gender = 'M'"</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>In reality people don't necessarily identify with gender binaries of female or male, and clinical databases will often reflect this. Female and male here are used simply for demonstrative purposes.</p>
</blockquote>
<h3 id="road-test">Road test</h3>
<p><p align="center"><img src="../images/concept_firstquery.gif"/></p></p>
<p>Before proceeding to create our <code>Encounters</code> Concepts, let's take a moment to confirm our <code>Demographics</code> Concepts are working as expected by running a quick query to see how many female patients are in our database.</p>
<ol>
<li>
<p>Click the <code>Find Patients</code> tab in the upper-left and drag <code>Female</code> over to the first panel.</p>
</li>
<li>
<p>Click <code>Run Query</code>. If you see a count of patients (assuming your database has female patients), great! You can even click <code>(i)</code> -&gt; <code>show detail</code> -&gt; <code>SQL</code> to see the query Leaf created using the new Concept. Success!</p>
</li>
</ol>
<blockquote>
<p>If your query didn't work (you'll get a modal window notifying you there was an error), check the Leaf logs to see if there were any syntax or other errors in the query</p>
</blockquote>
<h3 id="encounters">Encounters</h3>
<p><p align="center"><img src="../images/concept_encounters.gif"/></p></p>
<p>Now that you're hopefully getting the hang of creating Concepts, let's finish by creating <code>Encounters</code> Concepts so users can query information by encounter types.</p>
<p>Remember that the structure should look like this:</p>
<pre><code>Encounters
├── Inpatient
├── Outpatient
</code></pre>

<p>The field-level information for each Concept is (making sure to nest <code>Inpatient</code> and <code>Outpatient</code> under <code>Encounters</code>):</p>
<ul>
<li>Encounters<ul>
<li>General Display<ul>
<li><code>Name</code>: "Encounters"</li>
<li><code>Full text</code>: "Had an encounter"</li>
</ul>
</li>
<li>SQL<ul>
<li><code>Table, View, or Subquery</code>: "dbo.v_visit_occurrence"</li>
<li><code>WHERE Clause</code>:</li>
</ul>
</li>
</ul>
</li>
<li>Inpatient<ul>
<li>General Display<ul>
<li><code>Name</code>: "Inpatient"</li>
<li><code>Full text</code>: "Were admitted as an inpatient"</li>
</ul>
</li>
<li>SQL<ul>
<li><code>Table, View, or Subquery</code>: "dbo.v_visit_occurrence"</li>
<li><code>WHERE Clause</code>: "@.visit_type_code = 'IP'"</li>
</ul>
</li>
</ul>
</li>
<li>Outpatient<ul>
<li>General Display<ul>
<li><code>Name</code>: "Outpatient"</li>
<li><code>Full text</code>: "Had an outpatient visit"</li>
</ul>
</li>
<li>SQL<ul>
<li><code>Table, View, or Subquery</code>: "dbo.v_visit_occurrence"</li>
<li><code>WHERE Clause</code>: "@.visit_type_code = 'OP'"</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>And that's it!</p>
<h2 id="making-concepts-searchable">Making Concepts Searchable</h2>
<p>So you've been able to make Concepts that users can query - great! Over time you'll likely find that your Concept tree will grow as you find new use cases and data sources, and may become cumbersome for users to manually traverse.</p>
<p align="center"><img src="../images/concept_search.gif"/></p>

<p>Leaf's Concept search is a powerful feature which will automatically parse and tokenize the text in your Concepts. This allows users to search for Concepts of interest to them in any word order. To enable this feature, run the <a href="https://github.com/uwrit/leaf/blob/master/src/db/obj/app.sp_UpdateSearchIndexTables.StoredProcedure.sql">app.sp_UpdateSearchIndexTables</a> stored procedure.</p>
<p>Leaf search works by using a relatively simple <a href="https://en.wikipedia.org/wiki/Inverted_index">inverted index</a> and <a href="https://en.wikipedia.org/wiki/Search_engine_indexing#The_forward_index">forward index</a> search engine in pure SQL.</p>
<p>In SQL Server:</p>
<pre><code class="sql">EXEC app.sp_UpdateSearchIndexTables
</code></pre>

<p><strong>Note: Be sure to run this stored procedure after any edits or additions to your Concept tree to ensure that users can search the latest text for your Concepts.</strong></p>
<h2 id="final-thoughts">Final thoughts</h2>
<p>If you were able to successfully make the Concepts in this tutorial, congratulations! Hopefully this was helpful and intuitive enough for you to get started making your clinical database accessible and intuitive for your users as well. </p>
<p>Concepts can be extremely flexible and we've only scratched the surface of their functionality. If you'd like to learn more or have questions, head over to the <a href="../concept_reference">Concept Reference</a> page or jump to a section below:</p>
<ul>
<li><a href="../concept_reference/#name-subtext-and-full-text">Name, Subtext, and Full Text</a></li>
<li><a href="../concept_reference/#tooltips">Tooltips</a></li>
<li><a href="../concept_reference/#patient-count">Patient Count</a></li>
<li><a href="../concept_reference/#numeric-filters">Numeric Filters</a></li>
<li><a href="../concept_reference/#adding-dropdowns">Adding Dropdowns</a></li>
<li><a href="../concept_reference/#restricting-access">Restricting Access</a></li>
<li><a href="../concept_reference/#universal-ids">Universal IDs</a></li>
<li><a href="../concept_reference/#creating-concepts-by-sql-scripts">Creating Concepts by SQL Scripts</a></li>
</ul>
<p>As you were creating Concepts for your database, you may have found yourself thinking that it requires a change in perspective in how you as a developer would query a clinical database versus how best to represent Concepts to users. </p>
<p>We've found that this is just as much an art as a science, and it's ultimately an iterative process, so don't worry about getting it perfect the first time.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../concept_reference/" title="Concept Reference" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Concept Reference
              </div>
            </div>
          </a>
        
        
          <a href="../dataset_template_reference/" title="Dataset Templates Reference" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Dataset Templates Reference
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/uwrit/leaf" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.5f27aba8.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.27c6a5e6.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>